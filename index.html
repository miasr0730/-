<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roof Scan Pro v1.3 - Gemini 3 Flash</title>
    <style>
        :root { --primary: #1a73e8; --error: #d93025; --bg: #f8f9fa; --success: #188038; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #3c4043; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); margin-bottom: 15px; }
        h1 { font-size: 1.1rem; margin: 0 0 15px 0; color: var(--primary); display: flex; align-items: center; }
        #previewContainer { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; min-height: 50px; }
        .thumb-wrapper { min-width: 80px; height: 40px; background: #eee; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; border: 1px solid #dadce0; }
        .upload-label { display: block; background: #fff; border: 2px dashed var(--primary); color: var(--primary); padding: 20px; text-align: center; border-radius: 10px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .analyze-btn { width: 100%; background: var(--primary); color: white; padding: 16px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; }
        .analyze-btn:disabled { background: #ccc; }
        #logArea { background: #202124; color: #34a853; font-family: monospace; font-size: 0.8rem; padding: 15px; border-radius: 8px; height: 120px; overflow-y: auto; white-space: pre-wrap; margin-top: 10px; }
        .canvas-container { margin-top: 15px; }
        canvas { width: 100%; height: auto; background: #fff; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; }
        .alert { background: #fce8e6; color: var(--error); padding: 15px; border-radius: 8px; border: 1px solid #f9d2ce; margin-bottom: 15px; display: none; font-weight: bold; }
        .res-label { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; margin-bottom: 5px; color: white; }
        .bg-blue { background: var(--primary); }
        .bg-red { background: var(--error); }
    </style>
</head>
<body>

<div id="errorAlert" class="alert"></div>

<div class="card">
    <h1>ğŸ”‘ APIè¨­å®š</h1>
    <input type="password" id="apiKey" style="width:100%; padding:12px; border:1px solid #dadce0; border-radius:8px; box-sizing:border-box;" placeholder="Gemini API Keyã‚’å…¥åŠ›">
</div>

<div class="card">
    <h1>ğŸ“¸ å›³é¢è§£æ (ç”»åƒãƒ»PDFå¯¾å¿œ)</h1>
    <div id="previewContainer"></div>
    <label class="upload-label">
        ğŸ“„ å›³é¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ (ç”»åƒ/PDF)
        <input type="file" id="fileInput" accept="image/*,application/pdf" style="display:none">
    </label>
    <button id="analyzeBtn" class="analyze-btn">å³æ ¼è§£æã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Ÿè¡Œ</button>
</div>

<div class="card" id="resultCard" style="display:none;">
    <h1>ğŸ“Š è§£æçµæœãƒ»å¯¸æ³•ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤</h1>
    
    <div class="canvas-container">
        <span class="res-label bg-blue">ã€å¹³é¢æŠ•å½±å›³ã€‘æ°´å¹³å¯¸æ³•</span>
        <canvas id="planCanvas"></canvas>
    </div>

    <div class="canvas-container">
        <span class="res-label bg-red">ã€å®Ÿå¯¸æ³•å›³ã€‘3.5å¯¸å‹¾é…é©ç”¨å¾Œ</span>
        <canvas id="slopeCanvas"></canvas>
    </div>

    <div id="formulaText" style="font-size:
