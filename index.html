<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å±‹æ ¹ç©ç®— AI - æ±ç”¨ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ç‰ˆ</title>
    <style>
        :root { --primary: #0284c7; --bg: #f8fafc; }
        body { font-family: sans-serif; background: var(--bg); padding: 20px; color: #334155; }
        .container { background: white; padding: 30px; border-radius: 24px; max-width: 900px; margin: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .upload-area { border: 2px dashed #cbd5e1; padding: 40px; text-align: center; border-radius: 16px; cursor: pointer; background: #fff; transition: 0.3s; }
        .upload-area:hover { border-color: var(--primary); background: #f0f9ff; }
        .btn { width: 100%; padding: 20px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 1.2rem; cursor: pointer; margin-top: 20px; }
        #status { margin-top: 20px; text-align: center; font-weight: bold; color: var(--primary); }
        .logic-card { background: #f1f5f9; border-left: 5px solid var(--primary); padding: 20px; margin: 20px 0; border-radius: 8px; font-size: 0.95rem; line-height: 1.7; }
        .svg-viewer { background: #1e293b; border-radius: 16px; padding: 30px; text-align: center; margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; border-bottom: 1px solid #e2e8f0; text-align: left; }
        th { background: #f8fafc; font-size: 0.8rem; text-transform: uppercase; color: #64748b; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center;">å±‹æ ¹ç©ç®— AI <span style="color:var(--primary);">2.5 Hybrid</span></h2>
    
    <input type="password" id="apiKey" style="width:100%; padding:12px; margin-bottom:20px; border:1px solid #ddd; border-radius:8px;" placeholder="Gemini API Key">

    <label class="upload-area">
        <strong>ğŸ“‚ å…¨ã¦ã®å›³é¢ï¼ˆç«‹é¢ãƒ»å„éšå¹³é¢å›³ï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</strong>
        <p style="font-size:0.85rem; color:#64748b;">AIãŒã€Œå¤§å±‹æ ¹ã€ã¨ã€Œä¸‹å±‹ã€ã‚’è‡ªå‹•åˆ¤åˆ¥ã—ã€é©åˆ‡ãªéšã®å¯¸æ³•ã‚’æ¡ç”¨ã—ã¾ã™</p>
        <input type="file" id="fileInput" multiple accept="image/*" style="display:none;" onchange="handleFiles()">
    </label>

    <button id="runBtn" class="btn" onclick="executeGenericAI()">å›³é¢ã‚’ç·åˆè§£æã—ã¦ç©ç®—</button>
    <div id="status"></div>

    <div id="result-area" style="display:none;">
        <div class="logic-card" id="logic-output"></div>
        <div class="svg-viewer" id="svg-output"></div>
        <table>
            <thead><tr><th>éƒ¨ä½</th><th>ç®—å‡ºå¯¸æ³•(mm)</th><th>æ¡ç”¨ã—ãŸéš/æ ¹æ‹ </th></tr></thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>

<script>
    async function executeGenericAI() {
        const key = document.getElementById('apiKey').value;
        const files = document.getElementById('fileInput').files;
        if(!key || files.length === 0) return alert("è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„");

        const status = document.getElementById('status');
        status.innerText = "éšå±¤æ§‹é€ ã¨å±‹æ ¹å½¢çŠ¶ã‚’åˆ†æä¸­...";
        
        const b64s = await Promise.all(Array.from(files).map(f => toBase64(f)));

        const prompt = `ã‚ãªãŸã¯é«˜åº¦ãªå»ºç¯‰ç©ç®—ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚æä¾›ã•ã‚ŒãŸè¤‡æ•°ã®å›³é¢ã‹ã‚‰ã€ç‰©ä»¶ã®æ§‹é€ ã‚’æ­£ã—ãæŠŠæ¡ã—ç©ç®—ã—ã¦ãã ã•ã„ã€‚

ã€æ±ç”¨è§£æãƒ«ãƒ¼ãƒ«ã€‘
1. **éšå±¤ã®æŠŠæ¡**: ç«‹é¢å›³ã‹ã‚‰ã€Œå¤§å±‹æ ¹ï¼ˆæœ€ä¸Šéƒ¨ï¼‰ã€ã¨ã€Œä¸‹å±‹ï¼ˆ1éšéƒ¨åˆ†ã«ã‚ã‚‹å±‹æ ¹ï¼‰ã€ã®æœ‰ç„¡ã‚’åˆ¤åˆ¥ã—ã¦ãã ã•ã„ã€‚
2. **é©åˆ‡ãªå¯¸æ³•ã®é¸æŠ**: 
   - å¤§å±‹æ ¹ã®ç©ç®—ã«ã¯ã€ãã®ç›´ä¸‹ã®éšï¼ˆä¾‹ï¼š2éšå»ºã¦ãªã‚‰2Fï¼‰ã®å¹³é¢å›³å¯¸æ³•ã‚’æ¡ç”¨ã—ã¦ãã ã•ã„ã€‚
   - ä¸‹å±‹ãŒã‚ã‚‹å ´åˆã¯ã€1Få¹³é¢å›³ã‹ã‚‰ãã®çªå‡ºéƒ¨åˆ†ã®å¯¸æ³•ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
   - ãƒãƒ«ã‚³ãƒ‹ãƒ¼ã‚„è¢–å£ã¯ã€Œå±‹æ ¹ã€ã§ã¯ãªã„ãŸã‚ã€å¤–å£ãƒ©ã‚¤ãƒ³ã®åˆ¤å®šã‹ã‚‰é™¤å¤–ã—ã¦ãã ã•ã„ã€‚
3. **å¤–é¢åŸºæº–**: å¯¸æ³•ã¯ã€Œå£èŠ¯ã€ã§ã¯ãªãã€Œå¤–å£ã®å¤–é¢ï¼ˆç«¯ã‹ã‚‰ç«¯ï¼‰ã€ã‚’åŸºæº–å€¤ã¨ã—ã¦è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚
4. **å½¢çŠ¶ç‰¹å®š**: å¯„æ£Ÿã€åˆ‡å¦»ã€ç‰‡æµã‚Œã€å…¥æ¯å±‹ãªã©ã®å½¢çŠ¶ã‚’ç«‹é¢å›³ã‹ã‚‰æ­£ã—ãåˆ¤åˆ¥ã—ã€é¢æ•°ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚
5. **è»’ã®å‡º**: ç«‹é¢å›³ã«è¨˜è¼‰ã•ã‚ŒãŸå£å¤–é¢ã‹ã‚‰ã®çªå‡ºå¯¸æ³•ï¼ˆä¾‹ï¼š275mmï¼‰ã‚’å„ªå…ˆã—ã¦ãã ã•ã„ã€‚

ã€å‡ºåŠ›ã€‘
- **è§£æãƒ­ã‚°**: ã©ã®éšã®å¹³é¢å›³ã‚’ãƒ¡ã‚¤ãƒ³ã«æ¡ç”¨ã—ãŸã‹ã€å½¢çŠ¶ã‚’ã©ã†åˆ¤æ–­ã—ãŸã‹è©³ã—ãè¨˜è¿°ã€‚
- **SVG**: å±‹æ ¹ä¼å›³ã€‚
- **JSON**: %%%JSON_START%%% {"items": [{"name": "é …ç›®", "value": "æ•°å€¤", "note": "æ ¹æ‹ "}]} %%%JSON_END%%%`;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }, ...b64s.map(b => ({ inline_data: { mime_type: "image/jpeg", data: b } }))] }] })
            });
            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;

            renderResult(text);
            status.innerText = "âœ… è§£æå®Œäº†";
        } catch (e) {
            status.innerText = "âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ";
            console.error(e);
        }
    }

    function renderResult(text) {
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('logic-output').innerText = text.split('%%%')[0];
        
        const svgMatch = text.match(/<svg[\s\S]*?<\/svg>/);
        if(svgMatch) document.getElementById('svg-output').innerHTML = svgMatch[0];

        const jsonMatch = text.match(/%%%JSON_START%%%([\s\S]*?)%%%JSON_END%%%/);
        if(jsonMatch) {
            const items = JSON.parse(jsonMatch[1]).items;
            document.getElementById('table-body').innerHTML = items.map(it => 
                `<tr><td><b>${it.name}</b></td><td>${it.value}</td><td>${it.note}</td></tr>`
            ).join('');
        }
    }

    function toBase64(file) {
        return new Promise(res => {
            const reader = new FileReader();
            reader.onload = e => res(e.target.result.split(',')[1]);
            reader.readAsDataURL(file);
        });
    }
    function handleFiles() {
        document.getElementById('status').innerText = document.getElementById('fileInput').files.length + "æšã®å›³é¢ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚";
    }
</script>
</body>
</html>
